{% extends "master.html" %}

{% from "macros/lyrics.html" import render_lyrics %}

{% block content %}
<form class="form-group" method="post">
    <div class="row">
        <div class="form-group">
            <div name="id" class="form-group">
                {% if song %}
                    <input type="hidden" name="id" value="{{ song.eid }}"></input>
                {% else %}
                    <input type="hidden" name="id" value=""></input>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row" id="row-name-source">
        <div class="col-3" id="div-name">
            <div name="name" class="form-group">
                <label for="name">詩歌歌名</label>
                {% if song %}
                    <input class="form-control" name="name" value="{{ song['name'] }}"></input>
                {% else %}
                    <input class="form-control" name="name"></input>
                {% endif %}
            </div>
        </div>
        <div class="col-3" id="div-source">
            <div name="source" class="form-group">
                <label for="source">詞曲</label>
                {% if song %}
                    <input class="form-control" name="source" value="{{ song['source'] }}"></input>
                {% else %}
                    <input class="form-control" name="source"></input>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row" id="row-lyrics">
        {% if song and song['lyrics'] %}
            {% set counter = ['1'] %}
            {% for section, lyrics in song['lyrics'].items() %}
                {{ render_lyrics(section, lyrics, song.eid, loop.index) }}
                {% set _ = counter.append('1') %}
            {% endfor %}
            {% if add_section %}
                {{ render_lyrics(section, lyrics, song.eid, counter|length) }}
            {% endif %}
        {% else %}
            {{ render_lyrics(section, lyrics, song.eid) }}
        {% endif %}
    </div>
    <div class="row" id="row-add-section-button">
        <div class="col-12">
            <button class="btn btn-success btn-sm" type="submit" name="button" id="add-section-button" formaction="/songs/{{ song.eid }}/add_lyrics_section/">Add Section</button>
        </div>
    </div>
    {% if song %}
        <button class="btn btn-primary btn-lg" type="submit" formaction="/songs/{{ song.eid }}/update/">儲存</button>
        <button class="btn btn-danger btn-lg" type="submit" formaction="/songs/{{ song.eid }}/remove/">刪除</button>
    {% else %}
        <button class="btn btn-success btn-lg" name="save" type="submit" formaction="/songs/save">儲存</button>
    {% endif %}

</form>

{% endblock %}
